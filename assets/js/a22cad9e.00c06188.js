"use strict";(self.webpackChunkada_lang_io=self.webpackChunkada_lang_io||[]).push([[7809],{3760:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>m,contentTitle:()=>y,default:()=>b,frontMatter:()=>d,metadata:()=>k,toc:()=>f});var r=i(1716),n=i(7556),a=Object.defineProperty,o=Object.defineProperties,s=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,h=(e,t,i)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,u=(e,t)=>{for(var i in t||(t={}))p.call(t,i)&&h(e,i,t[i]);if(l)for(var i of l(t))c.call(t,i)&&h(e,i,t[i]);return e};const d={sidebar_position:152},y="D.1  Task Priorities",k={unversionedId:"arm/AA-D.1",id:"arm/AA-D.1",title:"D.1  Task Priorities",description:"We're still working on the Reference manual output.  Internal links are broken,",source:"@site/docs/arm/AA-D.1.mdx",sourceDirName:"arm",slug:"/arm/AA-D.1",permalink:"/docs/arm/AA-D.1",draft:!1,tags:[],version:"current",sidebarPosition:152,frontMatter:{sidebar_position:152},sidebar:"tutorialSidebar",previous:{title:"Annex D Real-Time Systems",permalink:"/docs/arm/AA-D"},next:{title:"D.2  Priority Scheduling",permalink:"/docs/arm/AA-D.2"}},m={},f=[{value:"Static Semantics",id:"static-semantics",level:4},{value:"Legality Rules",id:"legality-rules",level:4},{value:"Static Semantics",id:"static-semantics-1",level:4},{value:"Dynamic Semantics",id:"dynamic-semantics",level:4},{value:"Implementation Requirements",id:"implementation-requirements",level:4},{value:"Extensions to Ada 83",id:"extensions-to-ada-83",level:4},{value:"Wording Changes from Ada 83",id:"wording-changes-from-ada-83",level:4},{value:"Wording Changes from Ada 95",id:"wording-changes-from-ada-95",level:4},{value:"Extensions to Ada 2005",id:"extensions-to-ada-2005",level:4},{value:"Wording Changes from Ada 2012",id:"wording-changes-from-ada-2012",level:4}],g={toc:f};function b(e){var t,i=e,{components:a}=i,h=((e,t)=>{var i={};for(var r in e)p.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&l)for(var r of l(e))t.indexOf(r)<0&&c.call(e,r)&&(i[r]=e[r]);return i})(i,["components"]);return(0,r.kt)("wrapper",(t=u(u({},g),h),o(t,s({components:a,mdxType:"MDXLayout"}))),(0,r.kt)("h1",u({},{id:"d1--task-priorities"}),"D.1  Task Priorities"),(0,r.kt)("admonition",u({},{type:"warning"}),(0,r.kt)("p",{parentName:"admonition"},"We're still working on the Reference manual output.  Internal links are broken,\nas are a bunch of other things.\nSee the ",(0,r.kt)("a",u({parentName:"p"},{href:"https://github.com/ada-lang-io/ada-lang-io/issues/20"}),"tracking issue"))),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI05-0299-1"),"}"," [This subclause specifies the priority model for real-time systems. In addition, the methods for specifying priorities are defined.] "),(0,r.kt)("p",null,(0,r.kt)("em",null,'Paragraphs 2 through 6 were moved to Annex J, "Obsolescent Features".')," "),(0,r.kt)("h4",u({},{id:"static-semantics"}),"Static Semantics"),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," For a task type (including the anonymous type of a ",(0,r.kt)("code",null,(0,r.kt)("a",{href:"./AA-9.1#S0245"},"single_task_declaration")),"), protected type (including the anonymous type of a ",(0,r.kt)("code",null,(0,r.kt)("a",{href:"./AA-9.4#S0250"},"single_protected_declaration")),"), or subprogram, the following language-defined representation aspects may be specified:"),(0,r.kt)("p",null,"PriorityThe aspect Priority is an ",(0,r.kt)("code",null,(0,r.kt)("a",{href:"./AA-4.4#S0132"},"expression")),", which shall be of type Integer."),(0,r.kt)("p",null,(0,r.kt)("strong",null,"Aspect Description for "),(0,r.kt)("strong",null,"Priority: "),"Priority of a task object or type, or priority of a protected object or type; the priority is not in the interrupt range."),(0,r.kt)("p",null,"Interrupt_PriorityThe aspect Interrupt_Priority is an ",(0,r.kt)("code",null,(0,r.kt)("a",{href:"./AA-4.4#S0132"},"expression")),", which shall be of type Integer."),(0,r.kt)("p",null,(0,r.kt)("strong",null,"Aspect Description for "),(0,r.kt)("strong",null,"Interrupt_Priority: "),"Priority of a task object or type, or priority of a protected object or type; the priority is in the interrupt range."),(0,r.kt)("h4",u({},{id:"legality-rules"}),"Legality Rules"),(0,r.kt)("p",null,(0,r.kt)("em",null,"This paragraph was deleted."),"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," "),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," If the Priority aspect is specified for a subprogram, the ",(0,r.kt)("code",null,(0,r.kt)("a",{href:"./AA-4.4#S0132"},"expression"))," shall be static, and its value shall be in the range of System.Priority. "),(0,r.kt)("p",null,(0,r.kt)("strong",null,"Reason: "),"This value is needed before it gets elaborated, when the environment task starts executing. "),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," At most one of the Priority and Interrupt_Priority aspects may be specified for a given entity."),(0,r.kt)("p",null,(0,r.kt)("strong",null,"Ramification: "),"This includes specifying via pragmas (see J.15.11). Note that 13.1 prevents multiple specifications of a single representation aspect by any means. "),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," Neither of the Priority or Interrupt_Priority aspects shall be specified for a synchronized interface type."),(0,r.kt)("h4",u({},{id:"static-semantics-1"}),"Static Semantics"),(0,r.kt)("p",null,"The following declarations exist in package System: "),(0,r.kt)(n.Z,{mdxType:"CodeBlock"},"subtype Any_Priority is Integer range implementation-defined;","\n","subtype Priority is Any_Priority","\n","   range Any_Priority'First .. implementation-defined;","\n","subtype Interrupt_Priority is Any_Priority","\n","   range Priority'Last+1 .. Any_Priority'Last;","\n"),(0,r.kt)(n.Z,{mdxType:"CodeBlock"},"Default_Priority : constant Priority := (Priority'First + Priority'Last)/2;","\n"),(0,r.kt)("p",null,(0,r.kt)("strong",null,"Implementation defined: "),"The declarations of Any_Priority and Priority."),(0,r.kt)("p",null,"The full range of priority values supported by an implementation is specified by the subtype Any_Priority. The subrange of priority values that are high enough to require the blocking of one or more interrupts is specified by the subtype Interrupt_Priority. [The subrange of priority values below System.Interrupt_Priority'First is specified by the subtype System.Priority.]"),(0,r.kt)("p",null,(0,r.kt)("em",null,"This paragraph was deleted."),"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," "),(0,r.kt)("h4",u({},{id:"dynamic-semantics"}),"Dynamic Semantics"),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," The Priority aspect has no effect if it is specified for a subprogram other than the main subprogram; the Priority value is not associated with any task."),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI12-0404-1"),"}"," A ",(0,r.kt)("em",null,"task priority")," is an integer value that indicates a degree of urgency and is the basis for resolving competing demands of tasks for resources. Unless otherwise specified, whenever tasks compete for processors or other implementation-defined resources, the resources are allocated to the task with the highest priority value. The ",(0,r.kt)("em",null,"base priority")," of a task is the priority with which it was created, or to which it was later set by Dynamic_Priorities.Set_Priority (see D.5). At all times, a task also has an ",(0,r.kt)("em",null,"active priority"),", which generally is its base priority unless it inherits a priority from other sources. ",(0,r.kt)("em",null,"Priority inheritance")," is the process by which the priority of a task or other entity (for example, a protected object; see D.3) is used in the evaluation of another task's active priority. "),(0,r.kt)("p",null,(0,r.kt)("strong",null,"Implementation defined: "),"Implementation-defined execution resources."),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," The effect of specifying a Priority or Interrupt_Priority aspect for a protected type or ",(0,r.kt)("code",null,(0,r.kt)("a",{href:"./AA-9.4#S0250"},"single_protected_declaration"))," is discussed in D.3."),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," ","{",(0,r.kt)("em",null,"AI12-0081-1"),"}"," The ",(0,r.kt)("code",null,(0,r.kt)("a",{href:"./AA-4.4#S0132"},"expression"))," specified for the Priority or Interrupt_Priority aspect of a task type is evaluated each time an object of the task type is created (see 9.1). For the Priority aspect, the value of the ",(0,r.kt)("code",null,(0,r.kt)("a",{href:"./AA-4.4#S0132"},"expression"))," is converted to the subtype Priority; for the Interrupt_Priority aspect, this value is converted to the subtype Any_Priority. The priority value is then associated with the task object. "),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," Likewise, the priority value is associated with the environment task if the aspect is specified for the main subprogram."),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," The initial value of a task's base priority is specified by default or by means of a Priority or Interrupt_Priority aspect. [After a task is created, its base priority can be changed only by a call to Dynamic_Priorities.Set_Priority (see D.5).] The initial base priority of a task in the absence of an aspect is the base priority of the task that creates it at the time of creation (see 9.1). If the aspect Priority is not specified for the main subprogram, the initial base priority of the environment task is System.Default_Priority. [The task's active priority is used when the task competes for processors. Similarly, the task's active priority is used to determine the task's position in any queue when Priority_Queuing is specified (see D.4).]"),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI95-00357-01"),"}"," At any time, the active priority of a task is the maximum of all the priorities the task is inheriting at that instant. For a task that is not held (see D.11), its base priority is a source of priority inheritance unless otherwise specified for a particular task dispatching policy. Other sources of priority inheritance are specified under the following conditions: "),(0,r.kt)("p",null,(0,r.kt)("strong",null,"Discussion: "),"Other parts of the annex, e.g. D.11, define other sources of priority inheritance. "),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"8652/0072"),"}"," ","{",(0,r.kt)("em",null,"AI95-00092-01"),"}"," During activation, a task being activated inherits the active priority that its activator (see 9.2) had at the time the activation was initiated."),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"8652/0072"),"}"," ","{",(0,r.kt)("em",null,"AI95-00092-01"),"}"," During rendezvous, the task accepting the entry call inherits the priority of the entry call (see 9.5.3 and D.4)."),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI12-0276-1"),"}"," While starting a protected action on a protected object when the FIFO_Spinning admission policy is in effect, a task inherits the ceiling priority of the protected object (see 9.5, D.3, and D.4.1)."),(0,r.kt)("p",null,(0,r.kt)("strong",null,"Reason: "),"{",(0,r.kt)("em",null,"AI12-0005-1"),"}"," ","{",(0,r.kt)("em",null,"AI12-0276-1"),"}"," Priority inheritance is needed for FIFO_Spinning to ensure that lower priority tasks that initiate spin waiting earlier than other higher priority tasks continue to spin to ensure that they can be granted the resource when it becomes available in order to support FIFO ordering. Note that this rule only matters when tasks that can initiate a protected action on an object P can be on a different processor than P. In particular, this rule does not matter on a monoprocessor. "),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI12-0404-1"),"}"," While a task executes a protected action on a protected object, the task inherits the ceiling priority of the protected object (see 9.5 and D.3)."),(0,r.kt)("p",null,"In all of these cases, the priority ceases to be inherited as soon as the condition calling for the inheritance no longer exists."),(0,r.kt)("h4",u({},{id:"implementation-requirements"}),"Implementation Requirements"),(0,r.kt)("p",null,"The range of System.Interrupt_Priority shall include at least one value."),(0,r.kt)("p",null,"The range of System.Priority shall include at least 30 values."),(0,r.kt)("p",null,"NOTE 1   The priority expression can include references to discriminants of the enclosing type."),(0,r.kt)("p",null,"NOTE 2   It is a consequence of the active priority rules that at the point when a task stops inheriting a priority from another source, its active priority is re-evaluated. This is in addition to other instances described in this Annex for such re-evaluation."),(0,r.kt)("p",null,"NOTE 3   ","{",(0,r.kt)("em",null,"AI05-0248-1"),"}"," ","{",(0,r.kt)("em",null,"AI12-0440-1"),"}"," An implementation can provide a nonstandard mode in which tasks inherit priorities under conditions other than those specified above. "),(0,r.kt)("p",null,(0,r.kt)("strong",null,"Ramification: "),"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," The use of a Priority or Interrupt_Priority aspect does not require the package System to be named in a ",(0,r.kt)("code",null,(0,r.kt)("a",{href:"./AA-10.1#S0294"},"with_clause"))," for the enclosing ",(0,r.kt)("code",null,(0,r.kt)("a",{href:"./AA-10.1#S0286"},"compilation_unit")),". "),(0,r.kt)("h4",u({},{id:"extensions-to-ada-83"}),"Extensions to Ada 83"),(0,r.kt)("p",null,"The priority of a task is per-object and not per-type."),(0,r.kt)("p",null,"Priorities need not be static anymore (except for the main subprogram)."),(0,r.kt)("h4",u({},{id:"wording-changes-from-ada-83"}),"Wording Changes from Ada 83"),(0,r.kt)("p",null,"The description of the Priority pragma has been moved to this annex."),(0,r.kt)("h4",u({},{id:"wording-changes-from-ada-95"}),"Wording Changes from Ada 95"),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"8652/0072"),"}"," ","{",(0,r.kt)("em",null,"AI95-00092-01"),"}"," ",(0,r.kt)("strong",null,"Corrigendum:")," Clarified that dynamic priority changes are not transitive - that is, they don't apply to tasks that are being activated by or in rendezvous with the task that had its priority changed."),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI95-00357-01"),"}"," Generalized the definition of priority inheritance to take into account the differences between the existing and new dispatching policies. "),(0,r.kt)("h4",u({},{id:"extensions-to-ada-2005"}),"Extensions to Ada 2005"),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI05-0229-1"),"}"," Aspects Priority and Interrupt_Priority are new; ",(0,r.kt)("code",null,(0,r.kt)("a",{href:"./AA-2.8#S0019"},"pragma")),"s Priority and Interrupt_Priority are now obsolescent. "),(0,r.kt)("h4",u({},{id:"wording-changes-from-ada-2012"}),"Wording Changes from Ada 2012"),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI12-0081-1"),"}"," ",(0,r.kt)("strong",null,"Corrigendum:")," Clarified when the Priority and Interrupt_Priority aspect expressions are evaluated."),(0,r.kt)("p",null,"{",(0,r.kt)("em",null,"AI12-0276-1"),"}"," Added an additional case of priority inheritance when the new admission policy FIFO_Spinning is in effect. "))}b.isMDXComponent=!0}}]);