"use strict";(self.webpackChunkada_lang_io=self.webpackChunkada_lang_io||[]).push([[1278],{21177:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>g,contentTitle:()=>m,default:()=>h,frontMatter:()=>u,metadata:()=>k,toc:()=>f});var a=n(91716),r=Object.defineProperty,i=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,p=(e,t,n)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,c=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&p(e,n,t[n]);if(l)for(var n of l(t))d.call(t,n)&&p(e,n,t[n]);return e};const u={sidebar_position:100},m="Issues",k={unversionedId:"learn/getting-started/macos-issues/issues",id:"learn/getting-started/macos-issues/issues",title:"Issues",description:"- Linking error",source:"@site/docs/learn/getting-started/macos-issues/issues.md",sourceDirName:"learn/getting-started/macos-issues",slug:"/learn/getting-started/macos-issues/issues",permalink:"/docs/learn/getting-started/macos-issues/issues",draft:!1,tags:[],version:"current",sidebarPosition:100,frontMatter:{sidebar_position:100},sidebar:"tutorialSidebar",previous:{title:"Crates for macOS",permalink:"/docs/learn/getting-started/macos-issues/crates"},next:{title:"Tips and Tricks",permalink:"/docs/category/tips-and-tricks"}},g={},f=[{value:'<a name="linking-error">Linking error</a>',id:"linking-error",level:2},{value:"Immediate workround",id:"immediate-workround",level:3},{value:"Unintrusive workround",id:"unintrusive-workround",level:3}],b={toc:f};function h(e){var t,n=e,{components:r}=n,p=((e,t)=>{var n={};for(var a in e)s.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&l)for(var a of l(e))t.indexOf(a)<0&&d.call(e,a)&&(n[a]=e[a]);return n})(n,["components"]);return(0,a.kt)("wrapper",(t=c(c({},b),p),i(t,o({components:r,mdxType:"MDXLayout"}))),(0,a.kt)("h1",c({},{id:"issues"}),"Issues"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",c({parentName:"li"},{href:"#linking-error"}),"Linking error"))),(0,a.kt)("h2",c({},{id:"linking-error"}),(0,a.kt)("a",{name:"linking-error"},"Linking error")),(0,a.kt)("p",null,"As of November 2023, people have been getting errors like"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{}),'\u276f alr build\n\u24d8 Building myproj/myproj.gpr...\nLink\n   [link]         myproj.adb\n0  0x10034af43  __assert_rtn + 64\n1  0x10024cf43  ld::AtomPlacement::findAtom(unsigned char, unsigned long long, ld::AtomPlacement::AtomLoc const*&, long long&) const + 1411\n2  0x100269431  ld::InputFiles::SliceParser::parseObjectFile(mach_o::Header const*) const + 19745\n3  0x100279e44  ld::InputFiles::parseAllFiles(void (ld::AtomFile const*) block_pointer)::$_7::operator()(unsigned long, ld::FileInfo const&) const + 1380\n4  0x7ff8051315cd  _dispatch_client_callout2 + 8\n5  0x7ff805141e3e  _dispatch_apply_invoke + 214\n6  0x7ff80513159a  _dispatch_client_callout + 8\n7  0x7ff80514099d  _dispatch_root_queue_drain + 879\n8  0x7ff805140f22  _dispatch_worker_thread2 + 152\n9  0x7ff8052d5c06  _pthread_wqthread + 262\nld: Assertion failed: (resultIndex < sectData.atoms.size()), function findAtom, file Relocations.cpp, line 1336.\ncollect2: error: ld returned 1 exit status\ngprbuild: link of myproj.adb failed\ngprbuild: failed command was: /users/sdey02/.config/alire/cache/dependencies/gnat_native_13.2.1_c21501ad/bin/gcc myproj.o b__myproj.o -L/Users/sdey02/myproj/obj/development/ -L/Users/sdey02/myproj/obj/development/ -L/users/sdey02/.config/alire/cache/dependencies/gnat_native_13.2.1_c21501ad/lib/gcc/x86_64-apple-darwin21.6.0/13.2.0/adalib/ /users/sdey02/.config/alire/cache/dependencies/gnat_native_13.2.1_c21501ad/lib/gcc/x86_64-apple-darwin21.6.0/13.2.0/adalib/libgnat.a -Wl,-rpath,@executable_path/..//obj/development -Wl,-rpath,@executable_path/../..//.config/alire/cache/dependencies/gnat_native_13.2.1_c21501ad/lib/gcc/x86_64-apple-darwin21.6.0/13.2.0/adalib -o /Users/sdey02/myproj/bin//myproj\nerror: Command ["gprbuild", "-s", "-j0", "-p", "-P", "/Users/sdey02/myproj/myproj.gpr"] exited with code 4\nerror: Compilation failed.\n')),(0,a.kt)("p",null,"This is a result of an update of the developer toolkit (Xcode, or the ",(0,a.kt)("em",{parentName:"p"},"much")," smaller Command Line Tools) to version 15."),(0,a.kt)("h3",c({},{id:"immediate-workround"}),"Immediate workround"),(0,a.kt)("p",null,'An immediate workround is to use what\'s called the "classic linker" by using this Alire build command:'),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{}),"alr build -- -largs -Wl,-ld_classic\n")),(0,a.kt)("p",null,"or with ",(0,a.kt)("em",{parentName:"p"},"gprbuild")),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{}),"gprbuild -P my_proj -largs -Wl,-ld_classic\n")),(0,a.kt)("p",null,"(similarly for ",(0,a.kt)("em",{parentName:"p"},"gnatmake"),")"),(0,a.kt)("p",null,"A slightly less intrusive alternative would be to alter your GNAT Project (",(0,a.kt)("inlineCode",{parentName:"p"},".gpr"),") file by including a 'linker' package:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{}),'package Linker is\n   for Default_Switches ("Ada") use ("-Wl,-ld_classic");\nend Linker;\n')),(0,a.kt)("p",null,"Of course, if you already have a ",(0,a.kt)("inlineCode",{parentName:"p"},"package Linker")," it'll need adjusting."),(0,a.kt)("h3",c({},{id:"unintrusive-workround"}),"Unintrusive workround"),(0,a.kt)("p",null,"Until version 15.1 of the developer tools is released, you can install a beta version which doesn't have this problem."),(0,a.kt)("p",null,"Find out which set of developer tools you have installed by ",(0,a.kt)("inlineCode",{parentName:"p"},"xcrun --show-sdk-path"),": if the result starts ",(0,a.kt)("inlineCode",{parentName:"p"},"/Applications/Xcode.app/")," it's Xcode, if it starts ",(0,a.kt)("inlineCode",{parentName:"p"},"/Library/Developer/CommandLineLTools/")," it's the Command Line Tools."),(0,a.kt)("p",null,"Go to the ",(0,a.kt)("a",c({parentName:"p"},{href:"https://developer.apple.com/download/all/"}),'Apple Developer "More Downloads"')," page (you'll need a free account, you may need a separate Apple ID) and select the beta package matching your current developer tools: download and install it. The ",(0,a.kt)("em",{parentName:"p"},"beta 2")," set is known to work, ",(0,a.kt)("em",{parentName:"p"},"beta 3")," is available (18 November 2003)."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Note for the Xcode betas: they come as ",(0,a.kt)("inlineCode",{parentName:"p"},".xip")," files, which need to be extracted using Apple's proprietary ",(0,a.kt)("em",{parentName:"p"},"xip")," tool: ",(0,a.kt)("inlineCode",{parentName:"p"},"xip --expand package.xip"),". You'll need to tell macOS to use the beta using ",(0,a.kt)("inlineCode",{parentName:"p"},"xcode-select --switch"),".")))}h.isMDXComponent=!0}}]);