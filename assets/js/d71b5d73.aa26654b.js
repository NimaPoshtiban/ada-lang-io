"use strict";(self.webpackChunkada_lang_io=self.webpackChunkada_lang_io||[]).push([[5618],{1716:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>u});var n=a(6687);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(a),u=r,h=d["".concat(l,".").concat(u)]||d[u]||m[u]||o;return a?n.createElement(h,i(i({ref:t},c),{},{components:a})):n.createElement(h,i({ref:t},c))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},6967:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=a(9440),r=(a(6687),a(1716));const o={sidebar_position:110},i="13.8  Machine Code Insertions",s={unversionedId:"arm/AA-13.8",id:"arm/AA-13.8",title:"13.8  Machine Code Insertions",description:"A machine code insertion can be achieved by a call to a subprogram whose [sequenceofstatements contains code_statements.]",source:"@site/docs/arm/AA-13.8.md",sourceDirName:"arm",slug:"/arm/AA-13.8",permalink:"/docs/arm/AA-13.8",draft:!1,tags:[],version:"current",sidebarPosition:110,frontMatter:{sidebar_position:110},sidebar:"tutorialSidebar",previous:{title:"13.7  The Package System",permalink:"/docs/arm/AA-13.7"},next:{title:"13.9  Unchecked Type Conversions",permalink:"/docs/arm/AA-13.9"}},l={},p=[{value:"Syntax",id:"syntax",level:4},{value:"Name Resolution Rules",id:"name-resolution-rules",level:4},{value:"Legality Rules",id:"legality-rules",level:4},{value:"Static Semantics",id:"static-semantics",level:4},{value:"Implementation Permissions",id:"implementation-permissions",level:4},{value:"Examples",id:"examples",level:4},{value:"Extensions to Ada 83",id:"extensions-to-ada-83",level:4},{value:"Wording Changes from Ada 83",id:"wording-changes-from-ada-83",level:4}],c={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"138--machine-code-insertions"},"13.8  Machine Code Insertions"),(0,r.kt)("p",null,"[ A machine code insertion can be achieved by a call to a subprogram whose ",(0,r.kt)("a",{parentName:"p",href:"./AA-5.1#S0166"},"sequence_of_statements")," contains ",(0,r.kt)("a",{parentName:"p",href:"./AA-13.8#S0357"},"code_statement"),"s.] "),(0,r.kt)("h4",{id:"syntax"},"Syntax"),(0,r.kt)("p",null,"code_statement",(0,r.kt)("a",{id:"S0357"})," ::= ",(0,r.kt)("a",{parentName:"p",href:"./AA-4.7#S0163"},"qualified_expression"),";"),(0,r.kt)("p",null,"A ",(0,r.kt)("a",{parentName:"p",href:"./AA-13.8#S0357"},"code_statement")," is only allowed in the ",(0,r.kt)("a",{parentName:"p",href:"./AA-11.2#S0304"},"handled_sequence_of_statements")," of a ",(0,r.kt)("a",{parentName:"p",href:"./AA-6.3#S0216"},"subprogram_body"),". If a ",(0,r.kt)("a",{parentName:"p",href:"./AA-6.3#S0216"},"subprogram_body")," contains any ",(0,r.kt)("a",{parentName:"p",href:"./AA-13.8#S0357"},"code_statement"),"s, then within this ",(0,r.kt)("a",{parentName:"p",href:"./AA-6.3#S0216"},"subprogram_body")," the only allowed form of ",(0,r.kt)("a",{parentName:"p",href:"./AA-5.1#S0167"},"statement")," is a ",(0,r.kt)("a",{parentName:"p",href:"./AA-13.8#S0357"},"code_statement")," (labeled or not), the only allowed ",(0,r.kt)("a",{parentName:"p",href:"./AA-3.11#S0087"},"declarative_item"),"s are ",(0,r.kt)("a",{parentName:"p",href:"./AA-8.4#S0235"},"use_clause"),"s, and no ",(0,r.kt)("a",{parentName:"p",href:"./AA-11.2#S0305"},"exception_handler")," is allowed (",(0,r.kt)("a",{parentName:"p",href:"./AA-2.7#S0018"},"comment"),"s and ",(0,r.kt)("a",{parentName:"p",href:"./AA-2.8#S0019"},"pragma"),"s are allowed as usual). "),(0,r.kt)("h4",{id:"name-resolution-rules"},"Name Resolution Rules"),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"./AA-4.7#S0163"},"qualified_expression")," is expected to be of any type. "),(0,r.kt)("h4",{id:"legality-rules"},"Legality Rules"),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"./AA-4.7#S0163"},"qualified_expression")," shall be of a type declared in package System.Machine_Code. "),(0,r.kt)("p",null,"Ramification: This includes types declared in children of System.Machine_Code. "),(0,r.kt)("p",null,"A ",(0,r.kt)("a",{parentName:"p",href:"./AA-13.8#S0357"},"code_statement")," shall appear only within the scope of a ",(0,r.kt)("a",{parentName:"p",href:"./AA-10.1#S0294"},"with_clause")," that mentions package System.Machine_Code. "),(0,r.kt)("p",null,"Ramification: Note that this is not a note; without this rule, it would be possible to write machine code in compilation units which depend on System.Machine_Code only indirectly. "),(0,r.kt)("h4",{id:"static-semantics"},"Static Semantics"),(0,r.kt)("p",null,"The contents of the library package System.Machine_Code (if provided) are implementation defined. The meaning of ",(0,r.kt)("a",{parentName:"p",href:"./AA-13.8#S0357"},"code_statement"),"s is implementation defined. [Typically, each ",(0,r.kt)("a",{parentName:"p",href:"./AA-4.7#S0163"},"qualified_expression")," represents a machine instruction or assembly directive.] "),(0,r.kt)("p",null,"Discussion: For example, an instruction might be a record with an Op_Code component and other components for the operands. "),(0,r.kt)("p",null,"Implementation defined: The contents of the visible part of package System.Machine_Code, and the meaning of ",(0,r.kt)("a",{parentName:"p",href:"./AA-13.8#S0357"},"code_statement"),"s."),(0,r.kt)("h4",{id:"implementation-permissions"},"Implementation Permissions"),(0,r.kt)("p",null,"An implementation may place restrictions on ",(0,r.kt)("a",{parentName:"p",href:"./AA-13.8#S0357"},"code_statement"),"s. An implementation is not required to provide package System.Machine_Code. "),(0,r.kt)("p",null,"NOTE 1   {AI12-0440-1} An implementation can provide implementation-defined pragmas specifying register conventions and calling conventions."),(0,r.kt)("p",null,"NOTE 2   {AI95-00318-02} Machine code functions are exempt from the rule that a return statement is required. In fact, return statements are forbidden, since only ",(0,r.kt)("a",{parentName:"p",href:"./AA-13.8#S0357"},"code_statement"),"s are allowed. "),(0,r.kt)("p",null,'Discussion: The idea is that the author of a machine code subprogram knows the calling conventions, and refers to parameters and results accordingly. The implementation should document where to put the result of a machine code function, for example, "Scalar results are returned in register 0". '),(0,r.kt)("p",null,'NOTE 3   Intrinsic subprograms (see 6.3.1, "Conformance Rules") can also be used to achieve machine code insertions. Interface to assembly language can be achieved using the features in Annex B, "Interface to Other Languages". '),(0,r.kt)("h4",{id:"examples"},"Examples"),(0,r.kt)("p",null,"Example of a code statement: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ada"},"{AI05-0229-1} M : Mask;\nprocedure Set_Mask\n  with Inline;\n\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ada"},"procedure Set_Mask is\n  use System.Machine_Code; -- assume \"with System.Machine_Code;\" appears somewhere above\nbegin\n  SI_Format'(Code =&gt SSM, B =&gt M'Base_Reg, D =&gt M'Disp);\n  --  Base_Reg and Disp are implementation-defined attributes\nend Set_Mask;\n\n")),(0,r.kt)("h4",{id:"extensions-to-ada-83"},"Extensions to Ada 83"),(0,r.kt)("p",null,"Machine code functions are allowed in Ada 95; in Ada 83, only procedures were allowed. "),(0,r.kt)("h4",{id:"wording-changes-from-ada-83"},"Wording Changes from Ada 83"),(0,r.kt)("p",null,"The syntax for ",(0,r.kt)("a",{parentName:"p",href:"./AA-13.8#S0357"},"code_statement"),' is changed to say "',(0,r.kt)("a",{parentName:"p",href:"./AA-4.7#S0163"},"qualified_expression"),'" instead of "',(0,r.kt)("a",{parentName:"p",href:"./AA-3.2#S0028"},"subtype_mark"),"'",(0,r.kt)("a",{parentName:"p",href:"./AA-4.3#S0107"},"record_aggregate"),'". Requiring the type of each instruction to be a record type is overspecification.'))}m.isMDXComponent=!0}}]);